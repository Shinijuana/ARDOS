<!DOCTYPE html>
<html lang="en">
<head>
    <title>A-Frame World Tracking Example</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script type="module" src="js/world-tracking.js"></script>
</head>
<body>
    <div id="container"></div>
    <a-scene arjs="sourceType: webcam; debugUIEnabled: false" embedded>
        <a-assets>
            <a-asset-item id="sandcastleModel" src="assets/sand-castle.glb"></a-asset-item>
        </a-assets>
        <a-plane id="tracked" rotation="0 0 0" position="0 0 0" scale="1 1 1" opacity="0.1">
            <a-entity   
                id="sandcastle" 
                gltf-model="#sandcastleModel" 
                position="0 0 -5"
                scale=".6 .6 .6"  
                cursor="rayOrigin: mouse">
            </a-entity>
        </a-plane>
    </a-scene>

    <script>
        AFRAME.registerComponent('auto-enter-ar', {
            init: function () {
                const sceneEl = this.el;
                sceneEl.addEventListener('loaded', function () {
                    if (sceneEl.enterAR) {
                        sceneEl.enterAR();
                    } else if (sceneEl.enterVR) {
                        sceneEl.enterVR();  // Fallback to VR if AR is not available
                    }
                });
            }
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const sandcastle = document.getElementById('sandcastle');
            let initialScale = sandcastle.getAttribute('scale');
            let initialPosition = sandcastle.getAttribute('position');
            let isDragging = false;
            let previousTouches = [];

            document.querySelector('a-scene').addEventListener('touchstart', function (e) {
                if (e.touches.length === 1) {
                    isDragging = true;
                }
                previousTouches = e.touches;
            });

            document.querySelector('a-scene').addEventListener('touchmove', function (e) {
                if (e.touches.length === 1 && isDragging) {
                    const dx = e.touches[0].clientX - previousTouches[0].clientX;
                    const dy = e.touches[0].clientY - previousTouches[0].clientY;

                    initialPosition.x += dx * 0.01;
                    initialPosition.y -= dy * 0.01;

                    sandcastle.setAttribute('position', initialPosition);
                } else if (e.touches.length === 2) {
                    isDragging = false;

                    const dist1 = Math.hypot(
                        previousTouches[0].clientX - previousTouches[1].clientX,
                        previousTouches[0].clientY - previousTouches[1].clientY
                    );

                    const dist2 = Math.hypot(
                        e.touches[0].clientX - e.touches[1].clientX,
                        e.touches[0].clientY - e.touches[1].clientY
                    );

                    const scaleFactor = dist2 / dist1;
                    initialScale.x *= scaleFactor;
                    initialScale.y *= scaleFactor;
                    initialScale.z *= scaleFactor;

                    sandcastle.setAttribute('scale', initialScale);
                }
                previousTouches = e.touches;
            });

            document.querySelector('a-scene').addEventListener('touchend', function () {
                isDragging = false;
            });
        });
    </script>
</body>
</html>
